# 12. SQL 문장의 가독성 향상

## SQL 가독성이 높으면?

SQL 가독성이 좋다면 아래와 같은 장점이 있을 것 같아요.

- 다른 사람이 SQL을 보았을 때 작성 의도를 쉽게 이해할 수 있음
- 명확한 SQL 작성은 커뮤니케이션 비용을 줄이고, 업무 효율성을 높임
- 문제를 빠르게 파악할 수 있어 휴먼 에러를 방지할 수 있음
- 이러한 요소들이 갖춰지면 유지보수 용이

## DISTINCT를 함수처럼 사용하지 말자

`DISTINCT` 는 괄호를 사용해도 MySQL이 이를 제거한 상태로 실행하기 때문에, 결과는 동일하게 반환됩니다. 

괄호를 사용하면 마치 **함수처럼 보일 수 있어 오해의 소지**가 생길 수 있으니 `DISTINCT` 는 괄호 없이 명확하게 사용합시다.

## LEFT JOIN 시 드리븐 테이블에 대한 조건은 ON 절에 명시하자.

10 장에서도 다루었던 내용입니다.

`LEFT JOIN` 에서 조인 대상 테이블(드리븐 테이블)에 대한 조건을 `WHERE` 절에 명시하면, 결과가 `INNER JOIN` 과 동일해집니다.

따라서 `LEFT JOIN` 을 사용할 때는 드리븐 테이블의 조건을 반드시 `ON` 절에 명시해야 합니다.

또한, 드라이빙 테이블의 컬럼만 가져오거나, 드라이빙 테이블의 `COUNT` 를 조회하는 경우에는 JOIN이 불필요하므로, `LEFT JOIN` 이 정말 필요한 경우에만 사용하도록 합시다..!

## ORDER BY 없이 LIMIT n, m 문법 사용을 지양하자

쿼리에서 `ORDER BY` 없이 `LIMIT` 이 사용되면 어떤 의도로 사용하는 것인지 파악이 어렵습니다.

불필요한 `LIMIT` 는 제거하고, 페이지네이션과 같이 `LIMIT` 이 필요하다면 `ORDER BY` 를 명시합시다.

## FULL GROUP BY 형태로 사용하자

`SELECT .. GROUP BY` 쿼리에서 `GROUP BY` 절에 명시되지 않은 컬럼을 `SELECT` 절에서 참조하는 경우 의도치 않은 값을 가져올 수 있으니 반드시 집계함수를 사용합시다.

또한 불필요한 컬럼의 경우 제거하고, 만약 어떤 값이 반환되도 크게 상관 없는 경우라면 `ANY_VALUE()` 함수를 사용하는게 단순히 컬럼만 명시하는 것보다 가독성 측면에서 더 나은 선택일 수 있습니다.

## AND / OR 조건 함께 사용시 반드시 괄호를 명시하자

SQL 에서 `AND` 연산자는 `OR` 보다 우선순위가 높기 때문에, 괄호가 없는 `AND` 연산자를 먼저 처리하게 됩니다.

가독성과 우선순위 보장을 위해 `AND` / `OR` 조건 함께 사용시 반드시 괄호를 명시해서 사용합시다.

## 데이터 건수 조회는 COUNT(*) 을 사용하자

아래의 형태는 모두 동일한 건수를 반환합니다.

- COUNT(*)
- COUNT(1)
- SUM(1)
- COUNT(pk 컬럼)
- COUNT(not null 인 컬럼)

그렇기 때문에 의도를 더 명확하게 표현할 수 있는 형태가 권장됩니다.

- `SUM` 보다 `COUNT` 가 적절
  - 데이터 건수를 조회하는 목적이라면 `SUM(1)` 보다는 `COUNT` 함수를 사용하는 것이 직관적입니다.
    - `COUNT(*)` 는 MySQL이 내부적으로 최적화를 수행하여 특정 컬럼을 고려하지 않고 행의 개수를 직접 계산합니다.
    - 반면 `SUM(1)` 은 모든 행을 순회하며 1을 더하는 연산을 수행하기 때문에 불필요한 계산 오버헤드가 발생할 수 있습니다.

- `COUNT` 의 인자로 `*` 를 사용하는 것이 가장 명확
  - COUNT(*)는 특정 컬럼을 고려하지 않고 전체 행의 개수를 센다는 것이 명확하게 보입니다.
  - 반면 COUNT(1)이나 COUNT(pk 컬럼)을 사용하면 개발자마다 의미를 다르게 해석할 가능성이 있습니다.

### 성능 관점

MySQL에서는 `COUNT(*)` 와 `COUNT(1)` 의 성능 차이가 거의 없습니다.
다만, `COUNT(컬럼명)` 의 경우 NULL 값을 제외하고 개수를 세기 때문에, NULL 여부에 따라 예상과 다른 결과가 나올 수 있습니다.
`COUNT(*)` 는 테이블의 모든 행을 빠르게 카운트할 수 있도록 최적화되어 있으며, 가독성과 명확성 면에서도 가장 좋은 선택입니다.

따라서 데이터 건수를 조회할 때는 `COUNT(*)` 을 사용하는 것이 가장 적절합니다.
