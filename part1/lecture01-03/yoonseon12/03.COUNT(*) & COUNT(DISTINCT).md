# 03. COUNT(*) & COUNT(DISTINCT)

- μΌλ°μ μΌλ΅ `SELECT count(*)` λ” `SELECT *`  μΏΌλ¦¬μ™€ μμƒκ³Ό λ‹¤λ¥΄κ² μ„±λ¥μ΄ κ±°μ λ™μΌν•λ‹¤
    - `SELECT *` μ€ LIMIT μ΅°κ±΄μ΄ λ³΄ν†µ κ°™μ΄ μ‚¬μ©λλ‹¤.
    - `SELECT COUNT(*)` λ” LIMIT μ΅°κ±΄ μ—†μ΄ λ³΄ν†µ μ‚¬μ©λ¨ β†’ μλ”λΌλ„ MYSQLμ΄ μ κ±°ν•΄λ²„λ¦¬κΈ°μ— μ•„λ¬΄λ° μλ―Έκ°€ μ—†μ.
    - κ·Έλμ„ COUNT Queryλ” μ΅°κ±΄μ— μΌμΉν•λ” λ¨λ“  rowλ¥Ό μ½μ–΄μ•Όν•΄μ„ λ μ½”λ“ κ±΄μμ— λ”°λΌ ALL Query λ³΄λ‹¤  λ¶€ν•κ°€ ν¬κ³  μ‹κ°„μ΄ λ§μ΄ κ±Έλ¦¬λ” κ²½μ°κ°€ λ§μ
    - λ‹¤λ§ ALL Queryλ” λ¨λ“  κ²°κ³Όλ¥Ό λ³΄λ‚΄μ•Όν•κΈ°μ— COUNT Queryμ— λΉ„ν•΄ λ°”μ΄νΈ μκ°€ λ§μ„ μλ” μμ

## COUNT(*) μ„±λ¥ κ°μ„ 

### Convering Index

```sql
SELECT COUNT(*) WHERE idx_fd1 = ? AND idx_fd2 = ?;
SELECT COUNT(idx_fd2) WHERE idx_fd1 = ? AND idx_fd2 = ?;
```

- μ •ν™•ν• λ μ½”λ“ κ±΄μλ¥Ό ν™•μΈν•΄μ•Ό ν•λ” κ²½μ°μ— μµκ³ μ μ„±λ¥ μµμ ν™”λ” μ»¤λ²„λ§μΈλ±μ¤ μ‹¤ν–‰ κ³„νμΌλ΅ Queryκ°€ μ²λ¦¬λλ„λ΅ ν•΄μ£Όλ©΄ λ¨
- `idx_fd1` μ»¬λΌκ³Ό `idx_fd2` μ»¬λΌμΌλ΅ μΈλ±μ¤κ°€ μ¤€λΉ„λμ–΄ μλ‹¤λ©΄ μ„ 2κ°μ μΏΌλ¦¬λ” μΈλ±μ¤ μ»¬λΌ λ§μΌλ΅ μΏΌλ¦¬κ°€ μ²λ¦¬λκΈ°μ— ν…μ΄λΈ”μ λ°μ΄ν„°λ¥Ό μ½μ§€ μ•κ³  μΈλ±μ¤λ§ μ½μ–΄ μΏΌλ¦¬λ¥Ό μ²λ¦¬ μ™„λ£ν•κ²λ¨

### Non-Covering Index

```sql
SELECT CONUT(*) WHERE idx_fd1 = ? AND non_idx_fd2 = ?;
SELECT CONUT(non_idx_fd2) WHERE idx_fd1 = ?;
```

- μΈλ±μ¤ μ»¬λΌμΈ `idx_fd1` λ¥Ό ν†µν•΄ 1μ°¨ λ€μƒ λ μ½”λ“λ¥Ό μ°Ύκ³  `non_idx_fd2` μ»¬λΌμ„ μ½μ–΄ μ΅°κ±΄μ— μΌμΉν•λ”μ§€ νλ‹¨ν•΄μ•Όν•κΈ°μ— μ»¤λ²„λ§ μΈλ±μ¤λ΅ μ²λ¦¬λ  μ μ—†μ
- μ»¤λ²„λ§ μΈλ±μ¤λ΅ μ²λ¦¬ν•  μ μμΌλ‚ κ°κ°μ μΏΌλ¦¬μ where μ΅°κ±΄λ³„λ΅ μλ§μ€ μ»¤λ²„λ§ μΈλ±μ¤λ¥Ό μƒμ„±ν•μ—¬ νλ‹ν•  μλ” μ—†μ β†’ π’΅Β μ»¤λ²„λ§ μΈλ±μ¤λ” κΌ­ ν•„μ”ν• κ²½μ°μ—λ§ μ‚¬μ©ν•λ” κ²ƒμ„ κ¶μ¥

## COUNT(*) vs COUNT(DISTINCT expr)

- COUNT(*) λ” λ μ½”λ“ κ±΄μλ§ ν™•μΈ
- COUNT(DISTINCT expr)λ” μ„μ‹ν…μ΄λΈ”λ΅ μ¤‘λ³µ μ κ±°ν›„ κ±΄μλ¥Ό ν™•μΈν•¨
    - μ„μ‹ ν…μ΄λΈ” INSERT μ „ μ¤‘λ³µλ κ°’μ΄ μλ”μ§€ SELECT
    - μ¤‘λ³µλ κ²ƒμ€ λ¬΄μ‹ν•κ³  μ¤‘λ³µλμ§€ μ•μ€ λ°μ΄ν„°λ΅ μ„μ‹ ν…μ΄λΈ”μ— λ°μ΄ν„°λ¥Ό INSERT
    - μ„μ‹ ν…μ΄λΈ”μ λ μ½”λ“ μλ¥Ό ν™•μΈν•΄μ„ μµμΆ…μ μΌλ΅ κ²°κ³Όλ¥Ό λ°ν™
    - β†’ κ·Έλμ„ COUNT(*) λ³΄λ‹¤ 2-3 λ°° λλ ¤μ§€λ” μ‘μ—… λ°©μ‹μ„
    - β†’ λ μ½”λ“κ°€ λ§¤μ° λ§λ‹¤λ©΄ μ„μ‹ ν…μ΄λΈ”μ„ λ””μ¤ν¬λ΅ μ®κ²¨μ„ μ‘μ—…ν•κ² λλ”λ°, λ©”λ¨λ¦¬λ‚ CPU λΏλ§ μ•„λ‹λΌ λ””μ¤ν¬ μ‘μ—…κΉμ§€ κ°€μ¤‘λλ©΄μ„ μ„±λ¥μ΄ λ” λλ ¤μ§

## COUNT(*) νλ‹

- μµκ³ μ νλ‹ λ°©λ²•μ€ COUNT(*) λ¥Ό μ κ±°ν•λ” κ²ƒμ„β€¦ λ¬΄ν• νμ΄μ§•μ„ μ‚¬μ©ν•λ©΄ μ „μ²΄ COUNTκ°€ ν•„μ”ν•μ§€ μ•μΌλ‹ λ¬΄ν• νμ΄μ§• κ¶μ¥ν•¨
- μΏΌλ¦¬λ¥Ό μ κ±°ν•  μ μ—†μΌλ©΄, λ€λµμ  κ±΄μ ν™μ©
    - λ¶€λ¶„ λ μ½”λ“ κ±΄μ μ΅°ν
        - ν‘μ‹ν•  νμ΄μ§€ λ²νΈλ§νΌμ λ μ½”λ“λ§ κ±΄μ ν™•μΈ.
        - μλ¥Ό λ“¤μ–΄, ν• νμ΄μ§€μ— 20κ°μ λ μ½”λ“λ¥Ό λ³΄μ—¬μ£Όλ”λ° νμ΄μ§•μ„ μ„ν•΄ 10κ°κΉμ§€ λ³΄μ—¬μ¤€λ‹¤λ©΄
          SELECT COUNT(*) FROM (SELECT 1 FROM table LIMIT 200)
        - μ„μμ νμ΄μ§€ λ²νΈλ” ν‘κΈ°
            - μ²« νμ΄μ§€μ—μ„ 10κ° νμ΄μ§€ ν‘μ‹ν• ν›„ μ‹¤μ  ν•΄λ‹Ή νμ΄μ§€λ΅ μ΄λ™ν•λ©΄μ„ νμ΄μ§• λ²νΈ λ³΄μ •
        - ν†µκ³„ μ •λ³΄ ν™μ©
            - COUNT(*) μΏΌλ¦¬κ°€ WHERE μ΅°κ±΄μ„ κ°€μ§€μ§€ μ•μ€ κ²½μ°, ν…μ΄λΈ” ν†µκ³„λ¥Ό ν™μ©ν•  μ μμ

                ```sql
                SELECT TABLE_ROWS as rows
                  FROM INFORMATION_SCHEMA.tables
                 WHERE schema_name = ? AND table_name = ?;
                ```

            - COUNT(*) μΏΌλ¦¬κ°€ WHERE μ΅°κ±΄μ„ κ°€μ§„ κ²½μ° WHERE μ΅°κ±΄μ μΈλ±μ¤λ¥Ό μ‚¬μ©ν•  μ μλ„λ΅ μΈλ±μ‹±ν•κ³  Query μ‹¤ν–‰ κ³„νμ—μ„ rows μ»¬λΌμ„ μ΄μ©ν•΄ μμΈ΅λ row κ°’μ„ ν™•μΈν•  μ μμ
                - μ •ν™•λ„λ” λ‚®μ
                - λ§μ€ λ μ½”λ“ κ±΄μλ¥Ό COUNT ν•΄μ•Όν•λ‹¤λ©΄ λΉ λ¥΄κ³  ν¨μ¨μ μΌλ΅ κ±΄μ ν™•μΈ κ°€λ¥

> λΉ λ¥Έ μ„±λ¥μ€ κ³µμ§λ΅ μ–»μ–΄μ§€λ” κ²ƒμ΄ μ•„λ‹κΈ°μ— μµμ†ν•μ λ…Έλ ¥μΌλ΅ νλ‹ν•  μ μλ” λ°©λ²•μ„ μ°Ύλ” κ²ƒμ΄ μ¤‘μ”ν•κ² μ£ 
>

## COUNT μΏΌλ¦¬λ¥Ό μ κ±°ν•΄μ•Όν•λ” κ²½μ°μ™€ μΈλ±μ¤λ¥Ό ν™μ©ν•λ” κ²½μ°μ λΉ„κµ

### μ κ±° λ€μƒ

- WHERE μ΅°κ±΄ μ—†λ” COUNT(*)
- WHERE μ΅°κ±΄μ— μΌμΉν•λ” λ μ½”λ“ κ±΄μκ°€ λ§μ€ COUNT(*)

### μΈλ±μ¤ ν™μ©ν•μ—¬ μµμ ν™”ν•  μ μλ” λ€μƒ

- μ •ν™•ν• COUNT(*) κ°€ ν•„μ”ν• κ²½μ°
- COUNT(*) λ€μƒ κ±΄μκ°€ μ†λ‰μΈ κ²½μ°
- WHERE μ΅°κ±΄μ΄ μΈλ±μ¤λ΅ μ²λ¦¬ κ°€λ¥ν• μ»¤λ²„λ§ μΈλ±μ¤λ΅ νλ‹ κ°€λ¥ν• κ²½μ°

## COUNT(DISTINCT expr) νλ‹

- DISTINCT λ€μƒμ΄ μ λ‹ν¬ν• μ»¬λΌμ΄λ©΄ μ¤‘λ³µ μ κ±°κ°€ ν•„μ”μ—†μΌλ―€λ΅ μ κ±° ν•„μ”
- ORMμ—μ„ λ§λ“¤μ–΄μ£Όλ” Queryλ¥Ό μ§μ ‘ ν™•μΈν•κ³  κ²€ν† ν•΄λ³΄λ” κ²ƒμ„ κ¶μ¥ν•¨